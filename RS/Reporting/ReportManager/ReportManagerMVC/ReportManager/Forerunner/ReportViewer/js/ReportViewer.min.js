var forerunner=forerunner||{};forerunner.ssr=forerunner.ssr||{},$(function(){function r(n,t){this.reportObj=t,this.$container=n,this.isRendered=!1}var i=forerunner.ssr.constants.widgets,n=forerunner.ssr.constants.events,t=forerunner.ssr.constants.navigateType;$.widget(i.getFullname(i.reportViewer),{options:{reportServerURL:null,reportViewerAPI:"./api/ReportViewer",reportViewerLocFolder:"./forerunner/ReportViewer/loc/",reportPath:null,pageNum:1,pingInterval:3e5,toolbarHeight:0,setPageDone:null,pageNav:null,paramArea:null},_destroy:function(){},_create:function(){var n=this;setInterval(function(){n._sessionPing()},this.options.pingInterval),n.locData=forerunner.localize.getLocData(n.options.reportViewerLocFolder,"ReportViewer"),n.actionHistory=[],n.curPage=0,n.pages={},n.sessionID="",n.numPages=0,n.lock=0,n.$reportContainer=new $("<DIV class='fr-report-container'/>"),n.$reportAreaContainer=null,n.$loadingIndicator=new $("<div class='fr-report-loading-indicator' ><\/div>").text(n.locData.messages.loading),n.floatingHeaders=[],n.paramLoaded=!1,n.scrollTop=0,n.scrollLeft=0,n.loadLock=0,n.finding=!1,n.findStartPage=null,n.hasDocMap=!1,n.togglePageNum=0,n.findKeyword=null,n.element.append(n.$loadingIndicator),$(window).scroll(function(){n._updateTableHeaders(n)}),n.element.append(n.$reportContainer),n._addLoadingIndicator(),n._loadParameters(n.options.pageNum)},getCurPage:function(){var n=this;return n.curPage},getNumPages:function(){var n=this;return n.numPages},getReportViewerAPI:function(){var n=this;return n.options.reportViewerAPI},getReportServerURL:function(){var n=this;return n.options.reportServerURL},getReportPath:function(){var n=this;return n.options.reportPath},getSessionID:function(){var n=this;return n.sessionID},getHasDocMap:function(){var n=this;return n.hasDocMap},_setColHeaderOffset:function(n,t){if(t){var i=n.offset(),r=$(window).scrollLeft();r>i.left&&r<i.left+n.width()?(t.css("left",Math.min(r-i.left,n.width()-t.width())+"px"),t.fadeIn("fast")):t.hide()}},_setRowHeaderOffset:function(n,t){var u=this,i,r;t&&(i=n.offset(),r=$(window).scrollTop(),r>i.top&&r<i.top+n.height()?(t.css("top",Math.min(r-i.top,n.height()-t.height())+u.options.toolbarHeight+"px"),t.fadeIn("fast")):t.hide())},_addLoadingIndicator:function(){var n=this;n.loadLock=1,setTimeout(function(){n.showLoadingIndictator(n)},500)},showLoadingIndictator:function(n){if(n.loadLock===1){var t=n.$reportContainer.width()-212;n.$loadingIndicator.css("top",n.$reportContainer.scrollTop()+100+"px").css("left",t>0?t/2:"0px"),n.$reportContainer.css({opacity:.5}),n.$loadingIndicator.show()}},removeLoadingIndicator:function(){var n=this;n.loadLock=0,n.$reportContainer.css({opacity:1}),n.$loadingIndicator.hide()},_setPage:function(t){var i=this;i.pages[t].isRendered||i._renderPage(t),i.$reportAreaContainer?(i.$reportAreaContainer.find(".Page").detach(),i.$reportAreaContainer.append(i.pages[t].$container),i.curPage!==null&&i.curPage>t?i.pages[t].$container.show():i.pages[t].$container.show()):(i.$reportAreaContainer=$("<Div/>"),i.$reportAreaContainer.addClass("fr-report-areacontainer"),i.$reportContainer.append(i.$reportAreaContainer),i.$reportAreaContainer.append(i.pages[t].$container),i._touchNav(),i.pages[t].$container.fadeIn()),i.curPage=t,i._trigger(n.changePage,null,{newPageNum:t,paramLoaded:i.paramLoaded}),$(window).scrollLeft(i.scrollLeft),$(window).scrollTop(i.scrollTop),i.options.setPageDone&&(i._trigger(n.setPageDone),i.options.setPageDone=null),i.lock=0},_touchNav:function(){var n=this;$(n.element).swipe({fallbackToMouseEvents:!1,allowPageScroll:"auto",swipe:function(t,i){i==="left"||i==="up"?n.navToPage(n.curPage+1):n.navToPage(n.curPage-1)},swipeStatus:function(t,i){i==="start"&&n._hideTableHeaders(),i==="move"&&n._updateTableHeaders(n),i==="end"&&n._updateTableHeaders(n)},tap:function(n,t){$(t).trigger("click")},longTapThreshold:1e3})},refreshReport:function(){var n=this,t=null;n.lock!==1&&(n.sessionID="",n.lock=1,n.paramLoaded===!0&&(t=n.options.paramArea.reportParameter("getParamsList")),n._resetViewer(!0),n._loadPage(1,!1,null,t,!0))},navToPage:function(n){var t=this;n!==t.curPage&&t.lock!==1&&(t.scrollLeft=0,t.scrollTop=0,n>t.numPages&&(n=1),n<1&&(n=t.numPages),n!==t.curPage&&t.lock===0&&(t.lock=1,t._loadPage(n,!1)))},showDocMap:function(){$(".fr-docmap-panel").length>0&&$(".fr-docmap-panel").animate({height:"toggle"},100,function(){$(".fr-docmap-border").css("height",document.body.clientHeight-$(".fr-docmap-panel").offset().top)})},_cachePages:function(n){var i=this,r=n-1,u=n+1,t;for(r<1&&(r=1),u>i.numPages&&(u=i.numPages),t=r;t<=u;t++)i.pages[t]||t!==n&&i._loadPage(t,!0)},back:function(){var t=this,i=t.actionHistory.pop();i?(t._resetViewer(),t.options.reportPath=i.ReportPath,t.sessionID=i.SessionID,t.scrollLeft=i.ScrollLeft,t.scrollTop=i.ScrollTop,t._trigger(n.drillBack),t._removeParameters(),t._loadPage(i.CurrentPage,!1,null,null,!0)):t._trigger(n.back,null,{path:t.options.reportPath})},showNav:function(){var n=this;n.options.pageNav&&n.options.pageNav.pageNav("showNav")},flushCache:function(){var n=this;n.pages={},n.options.pageNav&&n.options.pageNav.pageNav("reset")},_prepareAction:function(){var n=this;(n.togglePageNum!==n.curPage||n.togglePageNum===0)&&$.ajax({url:n.options.reportViewerAPI+"/GetReportJSON/",data:{ReportServerURL:n.options.reportServerURL,ReportPath:n.options.reportPath,SessionID:n.sessionID,PageNumber:n.curPage,ParameterList:""},dataType:"json",async:!1,success:function(){n.togglePageNum=n.curPage},fail:function(){alert("Fail")}})},sort:function(n,t){var i=this,u,r=forerunner.ssr.constants.sortDirection;u=n===r.asc?r.desc:r.asc,$.getJSON(i.options.reportViewerAPI+"/SortReport/",{ReportServerURL:i.options.reportServerURL,SessionID:i.sessionID,SortItem:t,Direction:u}).done(function(n){i.numPages=n.NumPages,i._loadPage(n.NewPage,!1,null,null,!0)}).fail(function(){console.log("error"),i.removeLoadingIndicator()})},toggleItem:function(n){var i=this;i._prepareAction(),$.getJSON(i.options.reportViewerAPI+"/NavigateTo/",{NavType:t.toggle,ReportServerURL:i.options.reportServerURL,SessionID:i.sessionID,UniqueID:n}).done(function(n){n.Result===!0&&(i.scrollLeft=$(window).scrollLeft(),i.scrollTop=$(window).scrollTop(),i.pages[i.curPage]=null,i._loadPage(i.curPage,!1))}).fail(function(){console.log("error"),i.removeLoadingIndicator()})},navigateBookmark:function(n){var i=this;i._prepareAction(),$.getJSON(i.options.reportViewerAPI+"/NavigateTo/",{NavType:t.bookmark,ReportServerURL:i.options.reportServerURL,SessionID:i.sessionID,UniqueID:n}).done(function(t){t.NewPage===i.curPage?i._navToLink(n):(i.backupCurPage(),i._loadPage(t.NewPage,!1,n))}).fail(function(){console.log("error"),i.removeLoadingIndicator()})},navigateDrillthrough:function(n){var i=this;i._prepareAction(),$.getJSON(i.options.reportViewerAPI+"/NavigateTo/",{NavType:t.drillThrough,ReportServerURL:i.options.reportServerURL,SessionID:i.sessionID,UniqueID:n}).done(function(n){i.backupCurPage(),n.Exception?i.$reportAreaContainer.find(".Page").reportRender("writeError",n):(i.sessionID=n.SessionID,i.options.reportPath=n.ReportPath,n.ParametersRequired?(i.$reportAreaContainer.find(".Page").detach(),i._setScrollLocation(0,0),i._showParameters(1,n.Parameters)):(i._setScrollLocation(0,0),i._loadPage(1,!1,null,null,!0)))}).fail(function(){console.log("error"),i.removeLoadingIndicator()})},navigateDocumentMap:function(n){var i=this;$.getJSON(i.options.reportViewerAPI+"/NavigateTo/",{NavType:t.docMap,ReportServerURL:i.options.reportServerURL,SessionID:i.sessionID,UniqueID:n}).done(function(n){i.backupCurPage(),i._loadPage(n.NewPage,!1,null)}).fail(function(){console.log("error"),i.removeLoadingIndicator()})},backupCurPage:function(){var n=this;n.actionHistory.push({ReportPath:n.options.reportPath,SessionID:n.sessionID,CurrentPage:n.curPage,ScrollTop:$(window).scrollTop(),ScrollLeft:$(window).scrollLeft()})},_setScrollLocation:function(n,t){var i=this;i.scrollLeft=t,i.scrollTop=n},find:function(n,t,i){var r=this;if(n!==""){if(r.findKeyword&&r.findKeyword===n||(r.findKeyword=n,r.findStartPage=null),t===undefined&&(t=r.getCurPage()),i===undefined&&(i=r.getNumPages()),t>i){r.resetFind(),alert(r.locData.messages.completeFind);return}r.findStartPage===null&&(r.findStartPage=t),$.getJSON(r.options.reportViewerAPI+"/FindString/",{ReportServerURL:r.options.reportServerURL,SessionID:r.sessionID,StartPage:t,EndPage:i,FindValue:n}).done(function(t){t.NewPage!==0?(r.finding=!0,t.NewPage!==r.curPage?(r.options.setPageDone=function(){r.setFindHighlight(n)},r.pages[t.NewPage]=null,r._loadPage(t.NewPage,!1)):r.setFindHighlight(n)):r.findStartPage!==1?(r.find(n,1,r.findStartPage-1),r.findStartPage=1):(r.finding===!0?alert(r.locData.messages.completeFind):alert(r.locData.messages.keyNotFound),r.resetFind())}).fail(function(){console.log("error"),r.removeLoadingIndicator()})}},findNext:function(n){var t=this,i;if($(".fr-render-find-keyword").filter(".fr-render-find-highlight").first().removeClass("fr-render-find-highlight"),i=$(".fr-render-find-keyword").filter(":visible").filter(".Unread").first(),i.length>0)i.removeClass("Unread").addClass("fr-render-find-highlight").addClass("Read"),$(window).scrollTop(i.offset().top-150),$(window).scrollLeft(i.offset().left-250);else{if(t.getNumPages()===1){alert(t.locData.messages.completeFind),t.resetFind();return}t.getCurPage()+1<=t.getNumPages()?t.find(n,t.getCurPage()+1):t.findStartPage>1?t.find(n,1,t.findStartPage-1):(alert(t.locData.messages.completeFind),t.resetFind())}},setFindHighlight:function(n){var i=this,t;i._clearHighLightWord(),i._highLightWord(i.$reportContainer,n),t=i.$reportContainer.find(".fr-render-find-keyword").filter(":visible").filter(".Unread").first(),t.length>0&&(t.removeClass("Unread").addClass("fr-render-find-highlight").addClass("Read"),$(window).scrollTop(t.offset().top-150),$(window).scrollLeft(t.offset().left-250))},resetFind:function(){var n=this;n.finding=!1,n.findStartPage=null,n.findKeyword=null},showExport:function(){if($(".fr-render-export-panel").is(":hidden")){var n=$(".fr-button-export").filter(":visible");$(".fr-render-export-panel").css("left",n.offset().left)}$(".fr-render-export-panel").toggle()},exportReport:function(n){var t=this,i;$(".fr-render-export-panel").toggle(),i=t.options.reportViewerAPI+"/ExportReport/?ReportServerURL="+t.getReportServerURL()+"&ReportPath="+t.getReportPath()+"&SessionID="+t.getSessionID()+"&ParameterList=&ExportType="+n,window.open(i)},_loadParameters:function(n){var t=this;$.getJSON(t.options.reportViewerAPI+"/ParameterJSON/",{ReportServerURL:t.options.reportServerURL,ReportPath:t.options.reportPath}).done(function(i){t._addLoadingIndicator(),t._showParameters(n,i)}).fail(function(){console.log("error"),t.removeLoadingIndicator()})},_showParameters:function(t,i){var r=this,u;i.Type==="Parameters"?(r._removeParameters(),u=r.options.paramArea,u&&(r._trigger(n.showParamArea),u.reportParameter({$reportViewer:this}),u.reportParameter("writeParameterPanel",i,r,t,!1),r.paramLoaded=!0)):i.Exception?(r.$reportContainer.reportRender({reportViewer:this}),r.$reportContainer.reportRender("writeError",i),r.removeLoadingIndicator()):r._loadPage(t,!1)},_removeParameters:function(){var n=this,t;n.paramLoaded===!0&&(t=n.options.paramArea,t&&(t.reportParameter("removeParameter"),n.paramLoaded=!1))},_resetViewer:function(n){var t=this;t.numPages=0,t.floatingHeaders=[],n||(t.paramLoaded=!1),t.scrollTop=0,t.scrollLeft=0,t.finding=!1,t.findStartPage=null,t.hasDocMap=!1,t.togglePageNum=0,t.findKeyword=null},loadReport:function(n,t){var i=this;i._resetViewer(),i.options.reportPath=n,i.options.pageNum=t,i._loadParameters(t)},loadReportWithNewParameters:function(n){var t=this;t._resetViewer(!0),t._loadPage(1,!1,null,n,!0)},_loadPage:function(n,t,i,r,u){var f=this;if(u!==undefined&&u&&f.flushCache(),f.pages[n]&&f.pages[n].$container){t||(f._setPage(n),f._cachePages(n));return}r||(r=""),t||f._addLoadingIndicator(),f.togglePageNum=n,f.lock=1,$.getJSON(f.options.reportViewerAPI+"/ReportJSON/",{ReportServerURL:f.options.reportServerURL,ReportPath:f.options.reportPath,SessionID:f.sessionID,PageNumber:n,ParameterList:r}).done(function(r){f._writePage(r,n,t),f.lock=0,i&&f._navToLink(i),t||f._cachePages(n)}).fail(function(){console.log("error"),f.removeLoadingIndicator()})},_writePage:function(n,t,i){var u=this,f=$("<Div/>");(f.addClass("Page"),n)&&(f.reportRender({reportViewer:u}),u.pages[t]?(u.pages[t].$container=f,u.pages[t].reportObj=n):u.pages[t]=new r(f,n),u.sessionID=n.SessionID?n.SessionID:"",u.numPages=n.ReportContainer.NumPages===undefined?0:n.ReportContainer.NumPages,i||(u._renderPage(t),u.removeLoadingIndicator(),u._setPage(t)))},_renderPage:function(n){var t=this;t.pages[n]&&t.pages[n].isRendered===!0||(t.pages[n].reportObj.Exception?t.pages[n].$container.reportRender("writeError",t.pages[n].reportObj):(t.hasDocMap=t.pages[n].reportObj.HasDocMap,t.pages[n].$container.reportRender("render",t.pages[n].reportObj)),t.pages[n].isRendered=!0)},_sessionPing:function(){var n=this;n.sessionID&&n.sessionID!==""&&$.getJSON(n.options.reportViewerAPI+"/PingSession",{ReportServerURL:n.options.reportServerURL,PingSessionID:n.sessionID}).done(function(t){t.Status==="Fail"&&(n.sessionID="")}).fail(function(){console.log("ping error")})},_updateTableHeaders:function(n){$.each(n.floatingHeaders,function(t,i){n._setRowHeaderOffset(i.$tablix,i.$rowHeader),n._setColHeaderOffset(i.$tablix,i.$colHeader)})},_hideTableHeaders:function(){var n=this;$.each(n.floatingHeaders,function(n,t){t.$rowHeader&&t.$rowHeader.hide(),t.$colHeader&&t.$colHeader.hide()}),n.$floatingToolbar&&n.$floatingToolbar.hide()},_navToLink:function(n){$(document).scrollTop($("#"+n).offset().top-85)},_stopDefaultEvent:function(n){window.ActiveXObject?window.event.returnValue=!1:(n.preventDefault(),n.stopPropagation())},_getHeight:function(n){var i,t=n.clone().css({visibility:"hidden"});return t.find("img").remove(),$("body").append(t),i=t.height()+"px",t.remove(),this._convertToMM(i)},_convertToMM:function(n){if(!n)return 0;var i=n.match(/\D+$/),t=n.match(/\d+/);i.length===1&&(i=i[0]),t.length===1&&(t=t[0]);switch(i){case"px":return t/3.78;case"pt":return t*.352777777778;case"in":return t*25.4;case"mm":return t;case"cm":return t*10;case"em":return t*4.2175176}return t},_highLightWord:function(n,t){if(t&&t!==""){var i=this;$(n).each(function(){var n=$(this).get(0);n.normalize(),$.each(n.childNodes,function(n,r){var u,f,e,o,s;if(r.nodeType===3){u=r;try{for(f=u.data.toUpperCase().indexOf(t.toUpperCase());f<u.data.length;){if(f>=0)e=document.createElement("span"),e.className="fr-render-find-keyword Unread",o=u.splitText(f),u=o.splitText(t.length),s=o.cloneNode(!0),e.appendChild(s),r.parentNode.replaceChild(e,o);else break;f=u.data.toUpperCase().indexOf(t.toUpperCase())}}catch(h){}}else i._highLightWord($(r),t)})})}else return;return $(this)},_clearHighLightWord:function(){$(".fr-render-find-keyword").each(function(){var n=document.createTextNode($(this).text());$(this).replaceWith($(n))})}})});
//@ sourceMappingURL=ReportViewer.min.js.map