var forerunner=forerunner||{};forerunner.ssr=forerunner.ssr||{},$(function(){var n=forerunner.ssr.constants.widgets,t=forerunner.ssr.constants.events,i="fr-param-container";$.widget(n.getFullname(n.reportParameter),{options:{$reportViewer:null,pageNum:null},_formInit:!1,_paramCount:0,_defaultValueExist:!1,_loadedForDefault:!0,_init:function(){var n=this;n.element.html(null)},_destroy:function(){},_render:function(){var n=this,t;n.element.html(null),t=new $("<div class="+i+"><form name='ParameterForm' onsubmit='return false'><div class='fr-param-element-border'><input type='text' style='display:none'><\/div><div class='fr-param-submit-container'><input name='Parameter_ViewReport' type='button' class='fr-param-viewreport' value='"+n.options.$reportViewer.locData.paramPane.viewReport+"'/><\/div><\/form><\/div>"),n.element.css("display","block"),n.element.html(t),n._formInit=!0},writeParameterPanel:function(n,i,r){var u=this,f;u.options.pageNum=r,u._paramCount=parseInt(n.Count,10),u._defaultValueExist=n.DefaultValueExist,u._loadedForDefault=!0,u._render(),f=$(".fr-param-element-border"),$.each(n.ParametersList,function(n,t){f.append(u._writeParamControl(t,new $("<div />")))}),u._resetLabelWidth(),u.resetValidateMessage(),$("[name='ParameterForm']").validate({errorPlacement:function(n,t){$(t).is(":radio")?n.appendTo(t.parent("div").next("span")):$(t).attr("IsMultiple")==="True"?n.appendTo(t.parent("div").next("span")):n.appendTo(t.next("span"))},highlight:function(n){$(n).is(":radio")?$(n).parent("div").addClass("fr-param-error"):$(n).addClass("fr-param-error")},unhighlight:function(n){$(n).is(":radio")?$(n).parent("div").removeClass("fr-param-error"):$(n).removeClass("fr-param-error")}});$(".fr-param-viewreport").on("click",function(){u._submitForm()});u._paramCount===n.DefaultValueCount&&u._loadedForDefault?u._submitForm():u._trigger(t.render),u.options.$reportViewer.removeLoadingIndicator()},_submitForm:function(){var n=this,i;n._closeAllDropdown(),i=n.getParamsList(),i&&(n.options.$reportViewer.loadReportWithNewParameters(i),n._trigger(t.submit))},_writeParamControl:function(n,t){var i=this,f=new $("<div class='fr-param-label'>"+n.Name+"<\/div>"),u=new $("<div class='fr-param-item-container'><\/div>"),e=new $("<span class='fr-param-error-placeholder'/>"),r=n.ValidValues!==""?n.MultiValue==="True"?i._writeDropDownWithCheckBox(n):i._writeDropDownControl(n):n.Type==="Boolean"?i._writeRadioButton(n):i._writeTextArea(n);r.on("keypress",function(n){n.keyCode===13&&i._submitForm()});return u.append(r).append(i._addNullableCheckBox(n,r)).append(e),t.append(f).append(u),t},_getParameterControlProperty:function(n,t){var i=this;t.attr("AllowBlank",n.AllowBlank),n.Nullable!=="True"&&t.attr("required","true").watermark(i.options.$reportViewer.locData.paramPane.required),t.attr("ErrorMessage",n.ErrorMessage)},_addNullableCheckBox:function(n,t){var f=this,r,i,u;if(n.Nullable==="True"){r=new $("<Span />"),i=new $("<Input type='checkbox' class='fr-param-checkbox' name='"+n.Name+"' />");i.on("click",function(){i.attr("checked")==="checked"?(i.removeAttr("checked"),n.Type==="Boolean"?$(".fr-param-radio."+n.Name).removeAttr("disabled"):t.removeAttr("disabled").removeClass("fr-param-disable").addClass("fr-param-enable")):(i.attr("checked","true"),n.Type==="Boolean"?$(".fr-param-radio."+n.Name).attr("disabled","true"):t.attr("disabled","true").removeClass("fr-param-enable").addClass("fr-param-disable"))});return u=new $("<Label class='fr-param-label-null' />"),u.html(f.options.$reportViewer.locData.paramPane.nullField),r.append(i).append(u),r}return null},_writeRadioButton:function(n){var u=this,e=u.options.$reportViewer.locData.paramPane,t=[],f,i,r,o;for(t[0]=e.isTrue,t[1]=e.isFalse,f=new $("<div class='fr-param-checkbox-container' ismultiple='"+n.MultiValue+"' datatype='"+n.Type+"' ><\/div>"),i=0;i<t.length;i++){if(r=new $("<input type='radio' class='fr-param fr-param-radio "+n.Name+"' name='"+n.Name+"' value='"+t[i]+"' id='"+n.Name+"_radio_"+t[i]+"' datatype='"+n.Type+"' />"),u._getParameterControlProperty(n,r),u._hasDefaultValue(n)&&(n.Nullable==="True"?r.attr("disabled","true"):n.DefaultValues[0]===t[i]&&r.attr("checked","true")),u._paramCount===1)r.on("click",function(){u._submitForm()});o=new $("<label class='fr-param-radio-label' for='"+n.Name+"_radio_"+t[i]+"'>"+t[i]+"<\/label>"),f.append(r),f.append(o)}return f},_writeTextArea:function(n){var i=this,t=new $("<input class='fr-param' type='text' size='30' ismultiple='"+n.MultiValue+"' datatype='"+n.Type+"'  name='"+n.Name+"'/>");i._getParameterControlProperty(n,t);switch(n.Type){case"DateTime":t.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,onClose:function(){$("[name='"+n.Name+"']").valid(),i._paramCount===1&&i._submitForm()}}),t.attr("dateISO","true"),i._hasDefaultValue(n)&&t.datepicker("setDate",i._getDateTimeFromDefault(n.DefaultValues[0]));break;case"Integer":case"Float":t.attr("number","true"),i._hasDefaultValue(n)&&t.val(n.DefaultValues[0]);break;case"String":i._hasDefaultValue(n)&&t.val(n.DefaultValues[0])}return t},_writeDropDownControl:function(n){var t=this,e=!1,i=$("<select class='fr-param fr-param-select' ismultiple='"+n.MultiValue+"' name='"+n.Name+"' datatype='"+n.Type+"' readonly='true'>"),o,r,u,f;for(t._getParameterControlProperty(n,i),o=new $("<option value=''>&#60Select a Value&#62<\/option>"),i.append(o),r=0;r<n.ValidValues.length;r++)u=n.ValidValues[r].Value,f=new $("<option value='"+u+"'>"+n.ValidValues[r].Key+"<\/option>"),t._hasDefaultValue(n)&&n.DefaultValues[0]===u&&(f.attr("selected","true"),e=!0),i.append(f);if(e||(t._loadedForDefault=!1),t._paramCount===1)i.on("change",function(){t._submitForm()});return i},_writeDropDownWithCheckBox:function(n){var t=this,p=new $("<div style='display:inline-block;'/>"),u=new $("<Input type='text' class='fr-param-client' id='"+n.Name+"_fore' name='"+n.Name+"' readonly='true' ismultiple='"+n.MultiValue+"' datatype='"+n.Type+"'/>"),s,h,c,l,f,e,r,o,i,a,y;t._getParameterControlProperty(n,u);u.on("click",function(){t._popupDropDownPanel(n)});s=new $("<Input id='"+n.Name+"_hidden' class='fr-param' type='hidden' name='"+n.Name+"' ismultiple='"+n.MultiValue+"' datatype='"+n.Type+"'/>"),h=new $("<Img alt='Open DropDown List' src='../../Forerunner/ReportViewer/images/OpenDropDown.png' name='"+n.Name+"OpenDropDown' />");h.on("click",function(){t._popupDropDownPanel(n)});c=new $("<div class='fr-param-dropdown fr-param-dropdown-hidden' name='"+n.Name+"_DropDownContainer' value='"+n.Name+"' />");$(document).on("click",function(i){$(i.target).hasClass("ViewReport")||$(i.target).hasClass("fr-param-dropdown")||$(i.target).hasClass("fr-param-client")||$(i.target).hasClass(n.Name+"_DropDown_CB")||$(i.target).hasClass(n.Name+"_DropDown_lable")||$(i.target).attr("name")!==n.Name+"OpenDropDown"&&t._closeDropDownPanel(n)});for(l=t._getDefaultHTMLTable(),n.ValidValues.push({Key:"Select All",Value:"Select All"}),f="",e="",r=0;r<n.ValidValues.length;r++){r===0?(a=n.ValidValues[n.ValidValues.length-1],o=a.Key,i=a.Value):(o=n.ValidValues[r-1].Key,i=n.ValidValues[r-1].Value);var w=new $("<TR />"),b=new $("<TD/>"),k=new $("<Span />"),v=new $("<input type='checkbox' class='"+n.Name+"_DropDown_CB' id='"+n.Name+"_DropDown_"+i+"' value='"+i+"' />");t._hasDefaultValue(n)&&t._contains(n.DefaultValues,i)&&(v.attr("checked","true"),f+=o+",",e+=i+",");v.on("click",function(){this.value==="Select All"&&(this.checked===!0&&$("."+n.Name+"_DropDown_CB").each(function(){this.checked=!0}),this.value==="Select All"&&this.checked===!1&&$("."+n.Name+"_DropDown_CB").each(function(){this.checked=!1}))});y=new $("<label for='"+n.Name+"_DropDown_"+i+"' class='"+n.Name+"_DropDown_lable' name='"+n.Name+"_DropDown_"+i+"_lable'/>"),y.html(o),k.append(v).append(y),b.append(k),w.append(b),l.append(w)}return c.append(l),t._hasDefaultValue(n)&&(u.val(f.substr(0,f.length-1)),s.val(e.substr(0,e.length-1))),p.append(u).append(s).append(h).append(c),p},_setMultipleInputValues:function(n){var t="",i="";$("."+n.Name+"_DropDown_CB").each(function(){this.checked&&this.value!=="Select All"&&(t+=$("[name='"+n.Name+"_DropDown_"+this.value+"_lable']").html()+",",i+=this.value+",")}),$("#"+n.Name+"_fore").val(t.substr(0,t.length-1)),$("#"+n.Name+"_hidden").val(i.substr(0,i.length-1))},_popupDropDownPanel:function(n){var f=this,t=$("[name='"+n.Name+"_DropDownContainer']"),e=$("[name='"+n.Name+"']"),r=e.parent(),o=f.element.find("."+i),u=r.position().top+o.scrollTop();o.height()-u<t.height()+r.height()?t.css("top",u-t.height()):t.css("top",u+r.height()),t.hasClass("fr-param-dropdown-hidden")?t.width(e.width()).fadeOut("fast").removeClass("fr-param-dropdown-hidden").addClass("fr-param-dropdown-show"):f._closeDropDownPanel(n)},_closeDropDownPanel:function(n){var t=this;$("[name='"+n.Name+"_DropDownContainer']").hasClass("fr-param-dropdown-show")&&($("[name='"+n.Name+"_DropDownContainer']").fadeIn("fast",function(){t._setMultipleInputValues(n)}),$("[name='"+n.Name+"_DropDownContainer']").addClass("fr-param-dropdown-hidden").removeClass("fr-param-dropdown-show"),$("[name='"+n.Name+"']").focus().blur().focus())},_closeAllDropdown:function(){var n=this;$(".fr-param-dropdown").each(function(t,i){n._closeDropDownPanel({Name:$(i).attr("value")})})},getParamsList:function(){var r=this,n,t,i,o,u,c,e;if($("[name='ParameterForm']").length!==0&&$("[name='ParameterForm']").valid()===!0){t=[],$(".fr-param").filter(":text").each(function(){t.push({name:this.name,ismultiple:$(this).attr("ismultiple"),type:$(this).attr("datatype"),value:r._isParamNullable(this)})}),$(".fr-param").filter("[type='hidden']").each(function(){t.push({name:this.name,ismultiple:$(this).attr("ismultiple"),type:$(this).attr("datatype"),value:r._isParamNullable(this)})}),$(".fr-param").filter("select").each(function(){t.push({name:this.name,ismultiple:$(this).attr("ismultiple"),type:$(this).attr("datatype"),value:r._isParamNullable(this)})}),i={},$(".fr-param").filter(":radio").each(function(){this.name in i||(i[this.name]=null),this.checked===!0&&(i[this.name]=r._isParamNullable(this))});for(o in i)t.push({name:o,ismultiple:"",type:"Boolean",value:i[o]});u="",$(".fr-param").filter(":checkbox").filter(":checked").each(function(){u.indexOf(this.name)===-1&&(u+=this.name+",")});var f=u.split(","),h="",s="";for(n=0;n<f.length-1;n++)h=f[n],c=$("input[name='"+f[n]+"']:checked").length,$("input[name='"+f[n]+"']:checked").each(function(n){s+=n===c-1?this.value:this.value+","}),t.push({name:h,ismultiple:$(this).attr("ismultiple"),type:$(this).attr("datatype"),value:s});for(e="[",n=0;n<t.length;n++)e+=n!==t.length-1?"{'Parameter':'"+t[n].name+"','IsMultiple':'"+t[n].ismultiple+"','Type':'"+t[n].type+"','Value':'"+t[n].value+"'},":"{'Parameter':'"+t[n].name+"','IsMultiple':'"+t[n].ismultiple+"','Type':'"+t[n].type+"','Value':'"+t[n].value+"'}";return e+="]","{'ParamsList':"+e+"}"}return null},_isParamNullable:function(n){var t=$(".fr-param-checkbox").filter("[name='"+n.name+"']").first();return t.attr("checked")==="checked"||n.value===""?null:n.value},_resetLabelWidth:function(){var n=0;$(".fr-param-label").each(function(t,i){$(i).width()>n&&(n=$(i).width())}),$(".fr-param-label").each(function(t,i){$(i).width(n)})},resetValidateMessage:function(){var t=this,n=t.options.$reportViewer.locData.validateError;jQuery.extend(jQuery.validator.messages,{required:n.required,remote:n.remote,email:n.email,url:n.url,date:n.date,dateISO:n.dateISO,number:n.number,digits:n.digits,maxlength:$.validator.format(n.maxlength),minlength:$.validator.format(n.minlength),rangelength:$.validator.format(n.rangelength),range:$.validator.format(n.range),max:$.validator.format(n.max),min:$.validator.format(n.min)})},removeParameter:function(){var n=this;n._formInit=!1,$(".fr-param-container",this.element).detach()},_getDefaultHTMLTable:function(){return $("<Table cellspacing='0' cellpadding='0'/>")},_contains:function(n,t){for(var i=n.length;i--;)if(n[i]===t)return!0;return!1},_hasDefaultValue:function(n){var t=this;return t._defaultValueExist&&$.isArray(n.DefaultValues)&&n.DefaultValues[0]},_getDateTimeFromDefault:function(n){if(!n||n.length<9)return null;var t=n.substr(0,n.indexOf(" "));return t.substring(0,t.indexOf("/"))+"-"+t.substring(t.indexOf("/")+1,t.lastIndexOf("/"))+"-"+t.substring(t.lastIndexOf("/")+1,n.indexOf(" "))}})});
//@ sourceMappingURL=ReportParameter.min.js.map